syntax = "proto3";

import "google/protobuf/any.proto";

package asgard_messages;

enum PeerState{
    ACTIVE=0;
    IMMIGRANT=1;
    EXILE=2;
}

message Peer{
    uint64 peer_id=1;
    string endpoint=2;
    PeerState peer=3;
}

message AsgardPeerInfo{
    repeated Peer peer_info=1;
}

message AsgardSystemMessage{
    oneof message{
        AsgardPeerInfo asgard_peer_info_message=1;
    }
}

message OptionalMessageReign{
    uint32 message_reign=1;
}

message OptionalTransactionID{
    string transaction_id=1;
}

message AsgardMessage{
    uint64 log_index=1;
    oneof message{
        google.protobuf.Any user_message=2;
        AsgardSystemMessage system_message=3;
    }
    OptionalMessageReign message_reign=4;
    OptionalTransactionID transaction_id=5;
}

message AddEntry{
    uint32 reign=1;
    repeated AsgardMessage messages=3;
}

message Heartbeat {
    uint32 reign=1;
    uint64 leader_id=2;
    uint64 commit_index=3;
}

message FollowerUpdate{
    uint32 reign=1;
    uint64 log_index=2;
}

message CanvassRebellion{
    uint32 reign=1;
    uint64 candidate_id=2;
}

message RequestVotes{
    uint32 reign=1;
    uint64 candidate_id=2;
    uint64 last_log_index=3;
    uint32 reign_of_last_log_index=4;
}

message CanvassResponse{
    uint32 reign=1;
    uint64 peer_id=2;
    bool VoteGranted=3;
}

message GenericAsgardMessage{
    oneof generic_message{
        AddEntry add_entry_message=1;
        Heartbeat heart_beat_message=2;
        FollowerUpdate follower_update_message=3;
        CanvassRebellion canvass_rebellion_message=4;
        RequestVotes request_votes_message=5;
        CanvassResponse canvass_response_message=6;
    }
}